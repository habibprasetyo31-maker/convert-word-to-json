<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Converter Soal Lengkap → questions.json</title>
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/docx/7.7.0/docx.min.js"></script>
</head>
<body class="bg-gray-100 p-6">
<div class="max-w-4xl mx-auto bg-white shadow-xl rounded-xl p-6">

<h1 class="text-2xl font-bold mb-4">Converter Soal Lengkap → questions.json</h1>
<p class="mb-4 text-gray-600">Upload file .docx atau paste soal secara manual.</p>

<div class="mb-4">
    <input type="file" id="docxFile" accept=".docx" class="mb-2">
    <button onclick="readDocx()" class="bg-blue-600 text-white px-4 py-2 rounded">Baca File .docx</button>
</div>

<textarea id="input" class="w-full h-64 border p-3 rounded" placeholder="Paste soal dari Word di sini..."></textarea>

<div class="mt-4">
    <button onclick="convert()" class="bg-green-600 text-white px-4 py-2 rounded">Convert ke JSON</button>
</div>

<h2 class="text-xl font-bold mt-6">Hasil JSON</h2>
<pre id="output" class="bg-gray-200 p-4 rounded h-64 overflow-auto"></pre>

<button onclick="downloadJSON()" class="mt-4 bg-purple-600 text-white px-4 py-2 rounded">Download questions.json</button>

</div>

<script>
async function readDocx() {
    const file = document.getElementById("docxFile").files[0];
    if (!file) return alert("Pilih file .docx dulu");

    const arrayBuffer = await file.arrayBuffer();
    const doc = await docx.Document.load(arrayBuffer);
    let text = "";

    doc.paragraphs.forEach(p => {
        text += p.text + "\n";
    });

    document.getElementById("input").value = text;
}

function convert() {
    const text = document.getElementById("input").value;

    const blocks = text.split(/\n\s*\n/);
    let questions = [];
    let id = 1;

    blocks.forEach(block => {
        const lines = block.trim().split("\n");
        if (lines.length < 5) return;

        const question = lines[0].replace(/^\d+\.\s*/, "");

        const options = lines.filter(l => /^[A-Da-d]\./.test(l))
            .map(o => o.replace(/^[A-Da-d]\./, "").trim());

        let correct = "";
        const answerLine = lines.find(l => /jawaban/i.test(l));
        if (answerLine) {
            const letter = answerLine.match(/[A-D]/i)?.[0].toUpperCase();
            if (letter) {
                const index = "ABCD".indexOf(letter);
                correct = options[index];
            }
        }

        questions.push({
            id: id++,
            text: question,
            options: options,
            correct: correct || options[0]
        });
    });

    document.getElementById("output").textContent = JSON.stringify(questions, null, 2);
}

function downloadJSON() {
    const data = document.getElementById("output").textContent;
    if (!data.trim()) return alert("Belum ada data JSON!");

    const blob = new Blob([data], { type: "application/json" });
    const url = URL.createObjectURL(blob);

    const a = document.createElement("a");
    a.href = url;
    a.download = "questions.json";
    a.click();
}
</script>
</body>
</html>